<!DOCTYPE html>
<head>
  <title>design</title>
</head>

<body style = "background-color: rgb(33, 33, 33);">
  <style>
    .master {
      min-height:100vh;
      display : grid;
      grid-template-columns: 8.8rem 1fr 1fr;
      gap:1rem;
    }
    .code {
      height:95vh;
      overflow: auto;
      background-color: rgb(56, 56, 56);
    }
    .store {
      overflow: auto;
      height:95vh;
      min-width: 9.7rem;
      background-color: rgb(84, 84, 84);
    }

    .var,.if,.end, .print,.main, .empty, .else, .while ,.for, .math,.break,.continue, .def,.call,.return,.array,.push,.pop,.shift,.unshift,.color,.whileNe,.ifNtSeen,.mrkSeen,.ifNtWall,.moveTo{
     display:block;
      width:7.6rem;
      margin:0.4rem;
      background-color:rgb(119, 253, 126);
      justify-content:space-around;
      padding: 0.2rem;
      border-radius: 0.5ch;
    /*   felx-direction:column; */
    }
    .structure {
      background-color: rgb(244, 244, 244);
      min-height: 65vh;
    }
    .input {
      width:5ch;
    }
    .butt {
      width:9ch;
    }
    .nest {
      padding-left: 1.8rem;
    }
    .terminal {
      margin-top: 1rem;
      padding-left:0.8ch;
      color:rgb(105, 255, 105);
      height: 28vh;
      overflow: auto;
    }

    .see {
      margin:5%;
      margin-left: 20%;
      margin-right: 15%;
      display:inline-flex;
      flex-wrap: wrap;
      width:40ch;
    }
    .see div {
      font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      font-size: 1.8ch;
      width: 3.4ch;
      height: 3.4ch;
      margin: 0.15ch;
      border-style: solid;
      border-width: 0.25ch;
      border-radius: 1ch;
      text-align: center;
      /* align-content: center; */

    }
    .disp {
      height:98vh;
    }
    .green {
      background-color: rgb(57, 255, 100);
    }
    .black {
      background-color: black;
    }
    .blue{
      background-color: rgb(46, 70, 255);
    }
  </style>
  <div class = "navbar" style = "color: white;">Navbar here</div>
  <div class = "master">
    <div class = "store">
      <div class = "var" id = "variable">
        <label> <button class = "butt">int</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "array" id = "array">
        <label> <button class = "butt">array</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "push" id = "push">
        <label> <button class = "butt">push</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "pop" id = "pop">
        <label> <button class = "butt">pop</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "shift" id = "shift">
        <label> <button class = "butt">shift</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "unshift" id = "unshift">
        <label> <button class = "butt">unshift</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>

      <div class = "if" id = "ifcondition">
        <label> <button class = "butt">if</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      
      <div class = "for" id = "forStmt">
        <label> <button class = "butt">for</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>

      <div class = "while" id = "whileStmt">
        <label> <button class = "butt">while</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>

      <div class = "else" id = "elseCondition">
        <label> <button class = "butt">else</button></label>
      </div>

      <div class = "print" id = "printBlock">
        <label> <button class = "butt">print</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>

      <div class = "math" id = "math">
        <label> <button class = "butt">math</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
  
      <div class = "end" id = "end">
        <label > <button class = "butt">end</button></label>
      </div>
      <div class = "break" id = "break">
        <label > <button class = "butt">break</button></label>
      </div>
      <div class = "continue" id = "continue">
        <label > <button class = "butt">cont</button></label>
      </div>
      <div class = "def" id = "def">
        <label> <button class = "butt">def</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "call" id = "call">
        <label> <button class = "butt">call</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "empty" id = "isempty">
        <label> <button class = "butt">isempty</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "return" id = "return">
        <label> <button class = "butt">return</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "color" id = "color">
        <label> <button class = "butt">color</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "whileNe" id = "whileNe">
        <label> <button class = "butt">whileNe</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "ifNtSeen" id = "ifNtSeen">
        <label> <button class = "butt">ifNtSeen</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "ifNtWall" id = "ifNtWall">
        <label> <button class = "butt">ifNtWall</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "mrkSeen" id = "mrkSeen">
        <label> <button class = "butt">mrkSeen</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
      <div class = "moveTo" id = "moveTo">
        <label> <button class = "butt">moveTo</button></label>
        <input type = "text" name = "hello" class =  "input">
      </div>
     

    </div>

    <div class="code" id="code">
      <div class="main"><button>main</button></div>
      <div class="nest" id="codea"><div class="def" id="">
        <label> <button class="butt">def</button></label>
        <input type="text" name="hello" class="input" value = "dfs(i)">
      </div><div class="nest"><div class="if" id="">
        <label> <button class="butt">if</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="nest"><div class="print" id="">
        <label> <button class="butt">print</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="color" id="">
        <label> <button class="butt">color</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="return" id="">
        <label> <button class="butt">return</button></label>
        <input type="text" name="hello" class="input">
      </div></div><div class="end" id="">
        <label> <button class="butt">end</button></label>
      </div><div class="moveTo" id="">
        <label> <button class="butt">moveTo</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="mrkSeen" id="">
        <label> <button class="butt">mrkSeen</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="color" id="">
        <label> <button class="butt">color</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="for" id="">
        <label> <button class="butt">for</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="nest"><div class="ifNtSeen" id="">
        <label> <button class="butt">ifNtSeen</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="nest"><div class="ifNtWall" id="">
        <label> <button class="butt">ifNtWall</button></label>
        <input type="text" name="hello" class="input">
      </div><div class="nest"><div class="call" id="">
        <label> <button class="butt">call</button></label>
        <input type="text" name="hello" class="input">
      </div></div><div class="end" id="">
        <label> <button class="butt">end</button></label>
      </div></div><div class="end" id="">
        <label> <button class="butt">end</button></label>
      </div></div><div class="end" id="">
        <label> <button class="butt">end</button></label>
      </div></div><div class="end" id="">
        <label> <button class="butt">end</button></label>
      </div><div class="call" id="">
        <label> <button class="butt">call</button></label>
        <input type="text" name="hello" class="input">
      </div></div>
    </div>

    <div class = "disp">
      <div class = "structure">
        <button class = "runIt" id = "runpgm">Run</button>
        <button class = "runIt" id = "clc">clc</button>
        <button class = "runIt" id = "step">step</button>
        <div class = "center"><div class = "see"></div></div>
      </div>
      <div class = "terminal"></div>
    </div>
  </div>

  <script>
    //code for displaying grid
    let elem = document.querySelector(".see");
  for(let i = 0; i < 100; i++) {
    let newDiv = document.createElement('div');
    elem.prepend(newDiv);
  }
  let arr = Array.from(elem.childNodes);
  for(let box in arr) {
    // arr[box].innerHTML = box;
    arr[box].onclick = makeGreen;
    arr[box].onclick = makeWall;
    arr[box].setAttribute("id",box);

    // box.hidden = true;
  }

  let points = [];
  let visited = new Set();
  let waLL = new Set();
  let start;
  let end;
  function makeGreen(event) {
    if(points.length == 2) {
      arr[points[0]].classList.remove('green');
      points.shift();
      points.push(parseInt(event.target.id));
      event.target.classList.add('green');
      
    }
    else {
      event.target.classList.add('green');
      points.push(parseInt(event.target.id));
      start = points[0];
      end = points.at(-1);
    }
  }

  function makeWall(event) {
    if(event.ctrlKey){makeGreen(event);
    return;}
    if(points.includes(event.target.id))return;
    let elem = event.target;
    if(waLL.has(elem.id)) {
      waLL.delete(elem.id);
      elem.classList.remove('black');
    }
    else {
      waLL.add(parseInt(elem.id));
      elem.classList.add('black');
    }
  }
  //adding eventhandlers manually
  
  let nodes = document.querySelector('#codea');
  function addListener(nodes) {
    for (let node of nodes.childNodes) {
    node.onclick = makeCurrent;
    if(node.className == "nest")addListener(node);
    }
  }
  addListener(nodes);
  
  //code for the code block sequence

    let hasDiv = new Set();
    let leaveBlock = new Set();
    hasDiv.add("if").add("else").add("while").add("for").add("isempty").add("main").add("else").add("def").add("ifNtSeen").add("ifNtWall").add("whileNe");
    leaveBlock.add("end").add("else");
    let currentBlock = "";
    let listElem = Array.from(document.querySelectorAll(".store div"));
    let mainBlock = document.querySelector(".main");
    let addTo;
    mainBlock.onclick = makeCurrent;

    function makeCurrent(event) {
      addTo = this;
      //handling delete case
      if(event.shiftKey) {
        if(addTo == addTo.parentElement.lastElementChild)addTo = addTo.parentElement;
        addTo.nextElementSibling.remove();
        return;
      }
      //handling hiding of bloacks
      if ((event.ctrlKey || event.metaKey) && hasDiv.has(addTo.className) && (addTo != addTo.parentElement.lastElementChild && addTo.nextElementSibling.className == "nest")) {
        let nextElem = addTo.nextElementSibling;
        nextElem.hidden = (nextElem.hidden == true)?false:true;
        return;
      }
      if(currentBlock == "")return;

      //when a new block is to be added

      let newElem = currentBlock.cloneNode(true);
      newElem.setAttribute("id","");
      newElem.onclick = makeCurrent;
      
      //when nesting is required, a new div has to be added below selected block, if not already there
      if(hasDiv.has(addTo.className)) {

        if(addTo == addTo.parentElement.lastElementChild||addTo.nextElementSibling.className != "nest") {
          // alert("works"); 
          //adding new div below current element 
          let newDiv = document.createElement('div');
          newDiv.setAttribute("class","nest");
          addTo.after(newDiv);
        }
        
        addTo = addTo.nextElementSibling;
        if(leaveBlock.has(currentBlock.className)) {
          addTo.after(newElem);
          currentBlock = "";
          return;
        }
        addTo.prepend(newElem);
        currentBlock = "";
        return;
      }
      if(leaveBlock.has(currentBlock.className)) {
        addTo = addTo.parentElement;
      }
      addTo.after(newElem);
      currentBlock = "";
      return;
    }


    for(let elem of listElem) {
      elem.onclick = function() {
        //remove previous block from shine class
        // if(currentBlock != "")
        currentBlock = this;
        //add new currentblock to shine class
        // alert(currentBlock.className);
      }
    }
  </script>
  <script src = "interpret.js"></script>
</body>